<app-header title="Estimates" btnName="help" (updated)="help()">
  <ion-toolbar *ngIf="user$ | async as user">
    <ion-segment
      scrollable
      selectOnFocus="true"
      (ionChange)="segmentChanged($event)"
      [value]="active"
      mode="md"
    >
      <ng-container *ngIf="company$ |async as company">
        <ion-segment-button
          value="basic"
          *ngIf="user.permissionsList.includes('Basic Estimates') || user.permissionsList.includes('Super Admin') || user.role === 'Owner'"
        >
          <ion-label>Basic</ion-label>
        </ion-segment-button>
        <ion-segment-button
          value="inventory-rent"
          *ngIf="user.permissionsList.includes('Inventory Rent Estimates') || user.permissionsList.includes('Super Admin') || user.role === 'Owner'"
        >
          <ion-label>Inventory Rent</ion-label>
        </ion-segment-button>
        <ion-segment-button
          value="inventory-sell"
          *ngIf="user.permissionsList.includes('Inventory Sell Estimates') || user.permissionsList.includes('Super Admin') || user.role === 'Owner'"
        >
          <ion-label>Inventory Sell</ion-label>
        </ion-segment-button>
      </ng-container>
    </ion-segment>
  </ion-toolbar>
</app-header>
<ion-content class="ion-padding">
  <ng-container [ngSwitch]="active" *ngIf="company$ | async as company">
    <!-- BASIC ESTIMATE -->
    <ng-container *ngSwitchCase="'basic'">
      <ng-container *ngIf="company.totalEstimates > 0">
        <app-estimate-v2-table
          [value]="estimatesV2$"
          *ngIf="estimatesV2$ | async else loading"
          (selectedItem)="editEstimateV2($event)"
        ></app-estimate-v2-table>
        <ion-fab class="m-2" vertical="bottom" horizontal="end" slot="fixed">
          <ion-fab-button (click)="addEstimateV2()">
            <ion-icon name="add"></ion-icon>
          </ion-fab-button>
        </ion-fab>
      </ng-container>
      <app-page-placeholder
        *ngIf="company.totalEstimates === 0 || !company.totalEstimates"
        title="No Estimates?"
        subtitle=" Lets get started setting up your first estimate."
        (clicked)="addEstimateV2()"
      ></app-page-placeholder>
    </ng-container>
    <!-- INVENTORY RENT ESTIMATE -->
    <ng-container *ngSwitchCase="'inventory-rent'">
      <ng-container *ngIf="company.totalInventoryRentEstimates > 0">
        <app-estimate-v2-table
          [value]="inventoryEstimatesRent$"
          [showSite]="false"
          *ngIf="inventoryEstimatesRent$ | async else loading"
          (selectedItem)="editInvRentEstimate($event)"
        ></app-estimate-v2-table>
        <ion-fab class="m-2" vertical="bottom" horizontal="end" slot="fixed">
          <ion-fab-button (click)="addInvRentEstimate()">
            <ion-icon name="add"></ion-icon>
          </ion-fab-button>
        </ion-fab>
      </ng-container>
      <app-page-placeholder
        *ngIf="company.totalInventoryRentEstimates === 0 || !company.totalInventoryRentEstimates"
        title="No Estimates?"
        subtitle=" Lets get started setting up your first estimate."
        (clicked)="addInvRentEstimate()"
      ></app-page-placeholder>
    </ng-container>
    <!-- INVENTORY SELL ESTIMATE -->
    <ng-container *ngSwitchCase="'inventory-sell'">
      <ng-container *ngIf="company.totalInventoryEstimates > 0">
        <app-estimate-v2-table
          [value]="inventoryEstimatesSell$"
          [showSite]="false"
          *ngIf="inventoryEstimatesSell$ | async else loading"
          (selectedItem)="editInvSellEstimate($event)"
        ></app-estimate-v2-table>
        <ion-fab class="m-2" vertical="bottom" horizontal="end" slot="fixed">
          <ion-fab-button (click)="addInvSellEstimate()">
            <ion-icon name="add"></ion-icon>
          </ion-fab-button>
        </ion-fab>
      </ng-container>
      <app-page-placeholder
        *ngIf="company.totalInventoryEstimates === 0 || !company.totalInventoryEstimates"
        title="No Estimates?"
        subtitle=" Lets get started setting up your first estimate."
        (clicked)="addInvSellEstimate()"
      ></app-page-placeholder>
    </ng-container>
    <ng-template #loading>
      <div class="ion-padding">
        <app-skeleton-text></app-skeleton-text>
        <app-skeleton-text></app-skeleton-text>
        <app-skeleton-text></app-skeleton-text>
        <app-skeleton-text></app-skeleton-text>
      </div>
    </ng-template>
  </ng-container>
</ion-content>
