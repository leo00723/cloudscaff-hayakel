<ion-content
  *ngIf="{user: user$ | async , company: company$ | async} as data"
  [ngClass]="data?.user?.needsSetup ? '':'padding'"
  [class.ion-padding]="page !==5"
>
  <ng-container
    *ngIf="(data.user !== null && data.company !== null) else loading"
  >
    <app-editprofile
      *ngIf="data.user?.needsSetup else company"
      title="Complete Profile"
    ></app-editprofile>
    <ng-template #company>
      <div
        class="container d-grid justify-content-center align-items-center text-center"
        style="height: 100%"
        *ngIf="page !== 5"
      >
        <app-page-placeholder
          *ngIf="page === 0"
          title="Welcome to Cloudscaff"
          subtitle="Lets get started setting up your account."
          (clicked)="page = 1"
        ></app-page-placeholder>
        <ion-row class="justify-content-center" *ngIf="page === 1">
          <ion-col size="12">
            <ion-text color="primary">
              <h1>
                Which aspect of your business are you looking to optimize?
              </h1>
            </ion-text>
            <p class="lead">Choose one option below</p>
          </ion-col>
          <ion-col
            size="12"
            sizeMd="6"
            sizeLg="3"
            *ngFor="let category of categories"
            (click)="selectCategory(category)"
          >
            <ion-card color="light">
              <ion-text>
                <h3>{{category.name}}</h3>
              </ion-text>
            </ion-card>
          </ion-col>
        </ion-row>
        <ion-row class="justify-content-center" *ngIf="page === 2">
          <ion-col size="12">
            <ion-text color="primary">
              <h1>
                Which challenges of {{selected.name}} are you currently facing?
              </h1>
            </ion-text>
            <p class="lead">Choose any option below</p>
          </ion-col>
          <ion-col
            size="12"
            sizeMd="6"
            sizeLg="3"
            *ngFor="let challenge of selected.challenges"
            (click)="challenge.selected = !challenge.selected"
          >
            <ion-card
              color="light"
              [class.border-primary]="challenge.selected"
              [class.border-2]="challenge.selected"
            >
              <ion-text>
                <h3>{{challenge.problem}}</h3>
              </ion-text>
            </ion-card>
          </ion-col>
          <ion-col size="12">
            <div class="mt-5">
              <ion-button
                mode="ios"
                (click)="page = 1"
                fill="outline"
                shape="round"
              >
                Back
              </ion-button>
              <ion-button mode="ios" (click)="page = 3" shape="round">
                Next
              </ion-button>
            </div>
          </ion-col>
        </ion-row>
        <ion-row class="justify-content-center" *ngIf="page === 3">
          <ion-col size="12">
            <ion-text color="primary">
              <h1>How have these challenges impacted your business?</h1>
            </ion-text>
            <p class="lead">Choose any option below</p>
          </ion-col>
          <ion-col
            size="12"
            sizeMd="6"
            sizeLg="3"
            *ngFor="let impact of selected.impacts"
            (click)="impact.selected = !impact.selected"
          >
            <ion-card
              color="light"
              [class.border-primary]="impact.selected"
              [class.border-2]="impact.selected"
            >
              <ion-text>
                <h3>{{impact.effect}}</h3>
              </ion-text>
            </ion-card>
          </ion-col>
          <ion-col size="12">
            <div class="mt-5">
              <ion-button
                mode="ios"
                (click)="page = 2"
                fill="outline"
                shape="round"
              >
                Back
              </ion-button>
              <ion-button mode="ios" (click)="page = 4" shape="round">
                Next
              </ion-button>
            </div>
          </ion-col>
        </ion-row>
        <ion-row class="justify-content-center" *ngIf="page === 4">
          <ion-col size="12">
            <ion-text color="primary">
              <h1>Great news! We can Help!</h1>
            </ion-text>
            <p class="lead">Here is how Cloudscaff can assist your business.</p>
          </ion-col>

          <ion-col size="12" class="table-responsive text-start">
            <table class="table table-bordered">
              <thead>
                <tr>
                  <th>Challenge</th>
                  <th>Solution</th>
                </tr>
              </thead>
              <tbody>
                <ng-container *ngFor="let challenge of selected.challenges">
                  <tr *ngIf="challenge.selected">
                    <td>
                      <ion-text> {{challenge.problem}} </ion-text>
                    </td>
                    <td>
                      <ion-text> {{challenge.solution}} </ion-text>
                    </td>
                  </tr>
                </ng-container>
              </tbody>
            </table>
          </ion-col>
          <ion-col size="12" class="table-responsive text-start">
            <table class="table table-bordered">
              <thead>
                <tr>
                  <th>Impact</th>
                  <th>Benefits of Cloudscaff</th>
                </tr>
              </thead>
              <tbody>
                <ng-container *ngFor="let impact of selected.impacts">
                  <tr *ngIf="impact.selected">
                    <td>
                      <ion-text> {{impact.effect}} </ion-text>
                    </td>
                    <td>
                      <ion-text> {{impact.benefit}} </ion-text>
                    </td>
                  </tr>
                </ng-container>
              </tbody>
            </table>
          </ion-col>
          <ion-col size="12" class="mt-5">
            <ion-progress-bar
              *ngIf="isLoading"
              type="indeterminate"
            ></ion-progress-bar>
            <div *ngIf="!isLoading">
              <p class="small">Click next to complete your business profile.</p>
              <ion-button
                mode="ios"
                (click)="page = 2"
                fill="outline"
                shape="round"
              >
                Back
              </ion-button>
              <ion-button mode="ios" (click)="complete()" shape="round">
                Next
              </ion-button>
            </div>
          </ion-col>
        </ion-row>
      </div>
      <app-company
        *ngIf="page === 5"
        [showBack]="false"
        [showAll]="false"
        [onboarding]="true"
        title="Complete Business Info"
        (updated)="next(data,false)"
      ></app-company>
    </ng-template>
  </ng-container>
  <ng-template #loading>
    <div
      class="container d-flex justify-content-center align-items-center vh-100 text-center"
    >
      <ion-progress-bar width="100%" type="indeterminate"></ion-progress-bar>
    </div>
  </ng-template>
</ion-content>
