<ion-searchbar
  debounce="250"
  mode="ios"
  placeholder="Search by code or status"
  (ionChange)="updateFilter($event)"
>
</ion-searchbar>
<ng-container *ngIf="showScaffoldList">
  <ion-item class="text-end">
    <ion-badge slot="end" color="primary" mode="ios">Pending</ion-badge>
    <ion-badge slot="end" color="danger" mode="ios">Not safe for use</ion-badge>
    <ion-badge slot="end" color="success" mode="ios">Safe for use</ion-badge>
  </ion-item>
  <ngx-datatable
    class="bootstrap striped rounded-lg"
    [limit]="8"
    [rows]="temp$ | async"
    [rowHeight]="50"
    [columnMode]="'force'"
    [sortType]="sortType.multi"
    [headerHeight]="50"
    [footerHeight]="50"
    [selectionType]="selectionType.single"
    trackByProp="code"
    [scrollbarH]="true"
    (select)="onSelect($event)"
    [selected]="selected"
  >
    <ngx-datatable-column name="Code"></ngx-datatable-column>
    <ngx-datatable-column
      name="Start Date"
      cellClass="text-center"
      headerClass="text-center"
    >
      <ng-template let-row="row" let-value="value" ngx-datatable-cell-template>
        {{ value | date : "dd MMM yyyy" }}
      </ng-template>
    </ngx-datatable-column>
    <ngx-datatable-column
      name="End Date"
      cellClass="text-center"
      headerClass="text-center"
    >
      <ng-template let-row="row" let-value="value" ngx-datatable-cell-template>
        {{ value | date : "dd MMM yyyy" }}
      </ng-template>
    </ngx-datatable-column>
    <ngx-datatable-column
      name="Status"
      cellClass="text-center"
      headerClass="text-center"
    >
      <ng-template let-row="row" let-value="value" ngx-datatable-cell-template>
        <ion-badge [color]="getStatus(value)" mode="ios">{{
          value.split("-")[1]
        }}</ion-badge>
      </ng-template>
    </ngx-datatable-column>
  </ngx-datatable>
</ng-container>
<div class="mt-3 table-responsive" *ngIf="showRegister">
  <table
    class="table table-sm table-bordered"
    *ngIf="temp$ | async as scaffolds"
  >
    <thead>
      <tr class="table-light align-middle text-center">
        <th rowspan="2">#</th>
        <th rowspan="2">Code</th>
        <th colspan="3">Size</th>
        <th rowspan="2">Volume</th>
        <th rowspan="2">No. of Platforms</th>
        <th rowspan="2">Total Area</th>
        <th rowspan="2">Status</th>
        <th rowspan="2">Notes</th>
        <th rowspan="2">Created By</th>
      </tr>
      <tr class="table-light text-center">
        <th>Length</th>
        <th>Width</th>
        <th>Height</th>
      </tr>
    </thead>
    <tbody>
      <ng-container
        *ngFor="
          let scaffold of scaffolds | callback : filterScaffold;
          let i = index
        "
      >
        <ng-container *ngIf="scaffold.latestHandover">
          <!-- SCAFFOLD -->
          <tr class="small text-center align-middle">
            <td>{{ i + 1 }}</td>
            <!-- (click)="viewHandover(scaffold.latestHandover)"
            class="text-primary cursor-pointer" -->
            <th>
              {{ scaffold.code }}
            </th>
            <td>{{ scaffold.latestHandover.scaffold.scaffold.length }}</td>
            <td>{{ scaffold.latestHandover.scaffold.scaffold.width }}</td>
            <td>{{ scaffold.latestHandover.scaffold.scaffold.height }}</td>
            <td>
              {{
                +scaffold.latestHandover.scaffold.scaffold.length *
                  +scaffold.latestHandover.scaffold.scaffold.width *
                  +scaffold.latestHandover.scaffold.scaffold.height
              }}
            </td>
            <td>
              {{ scaffold.latestHandover.scaffold.totalPlatforms }}
            </td>
            <td>
              {{ scaffold.latestHandover.scaffold.totalArea }}
            </td>
            <td
              ngClass="text-{{
                scaffold.latestHandover.type === 'Erected'
                  ? 'success'
                  : 'danger'
              }}"
            >
              {{ scaffold.latestHandover.type }}
            </td>

            <td>{{ scaffold.latestHandover.notes }}</td>
            <td>{{ scaffold.latestHandover.createdByName }}</td>
          </tr>
          <!-- ATTACHMENTS -->
          <tr
            class="small text-center"
            *ngFor="
              let attachment of scaffold.latestHandover.scaffold.attachments;
              let j = index
            "
          >
            <td>{{ i + 1 }}.{{ j + 1 }}</td>
            <td>Attachment</td>
            <td>{{ attachment.length }}</td>
            <td>{{ attachment.width }}</td>
            <td>{{ attachment.height }}</td>
            <td>
              {{ +attachment.length * +attachment.width * +attachment.height }}
            </td>
            <td colspan="5"></td>
          </tr>
        </ng-container>
      </ng-container>
    </tbody>
  </table>
</div>
