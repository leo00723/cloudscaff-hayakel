<ng-container *ngIf="site$ |async as site">
  <app-header
    title="{{site.code}} "
    [showMenu]="false"
    [showBack]="true"
    path="/dashboard/sites"
    btnName="settings-outline"
    (updated)="editSite(site)"
  >
    <ion-toolbar *ngIf="user$ |async as user">
      <ion-segment
        (ionChange)="segmentChanged($event)"
        selectOnFocus="true"
        [value]="active"
        mode="md"
      >
        <ion-segment-button value="scaffolds">
          <ion-label>Scaffolds</ion-label>
        </ion-segment-button>
        <ion-segment-button value="inventory">
          <ion-label>Inventory</ion-label>
        </ion-segment-button>
        <ion-segment-button value="requests">
          <ion-label>Requests</ion-label>
        </ion-segment-button>
        <ion-segment-button value="returns">
          <ion-label>Returns</ion-label>
        </ion-segment-button>
        <ion-segment-button
          value="estimates"
          *ngIf="user.role !== 'Supervisor'"
        >
          <ion-label>Estimates</ion-label>
        </ion-segment-button>
      </ion-segment>
    </ion-toolbar>
  </app-header>

  <ion-content fullscreen="true" class="ion-padding">
    <ng-container [ngSwitch]="active">
      <div *ngSwitchDefault>
        <app-scaffold-table
          [value]="scaffolds$"
          *ngIf="scaffolds$ | async else loading"
          (selectedItem)="viewScaffold($event)"
        ></app-scaffold-table>
      </div>
      <div *ngSwitchCase="'inventory'">
        <app-site-inventory-table
          [value]="items.items"
          *ngIf="inventoryItems$ | async as items else empty"
        ></app-site-inventory-table>
        <ng-template #empty>
          <app-site-inventory-table [value]="[]"></app-site-inventory-table
        ></ng-template>
      </div>
      <div *ngSwitchCase="'requests'">
        <app-requests-table
          [value]="requests$"
          *ngIf="requests$ | async else loading"
          (selectedItem)="viewRequest($event,site)"
        ></app-requests-table>
        <ion-fab class="m-2" vertical="bottom" horizontal="end" slot="fixed">
          <ion-fab-button (click)="addRequest(site)">
            <ion-icon name="add"></ion-icon>
          </ion-fab-button>
        </ion-fab>
      </div>
      <div *ngSwitchCase="'returns'">
        <app-returns-table
          [value]="returns$"
          *ngIf="returns$ | async else loading"
          (selectedItem)="viewReturn($event,site)"
        ></app-returns-table>
        <ion-fab class="m-2" vertical="bottom" horizontal="end" slot="fixed">
          <ion-fab-button (click)="addReturn(site)">
            <ion-icon name="add"></ion-icon>
          </ion-fab-button>
        </ion-fab>
      </div>
      <div *ngSwitchCase="'estimates'">
        <app-estimate-table
          [value]="estimates$"
          *ngIf="estimates$ | async else loading"
          (selectedItem)="viewEstimate($event)"
        ></app-estimate-table>
      </div>
      <ng-template #loading>
        <div class="ion-padding">
          <app-skeleton-text></app-skeleton-text>
          <app-skeleton-text></app-skeleton-text>
          <app-skeleton-text></app-skeleton-text>
          <app-skeleton-text></app-skeleton-text>
        </div>
      </ng-template>
    </ng-container>
  </ion-content>
</ng-container>
