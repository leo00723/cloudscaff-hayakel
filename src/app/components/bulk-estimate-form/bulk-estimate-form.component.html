<!-- SCAFFOLDS -->
<form [formGroup]="form" *ngIf="form">
  <app-title-block>
    {{ company.terminology.scaffold }} Details
  </app-title-block>
  <ion-row class="card-outline mb-3">
    <ion-col size="12">
      <ion-row formGroupName="scaffold">
        <ion-col size="12">
          <app-input-select-reactive
            title="Scaffold Type"
            placeholder="Select Type"
            controlName="type"
            [form]="field('scaffold')"
            [selectedText]="field('scaffold.type').value"
          >
            <ng-container *ngIf="types$ | async as types">
              <ion-select-option [value]="type" *ngFor="let type of types.types"
                >{{ type }}
              </ion-select-option>
            </ng-container>
          </app-input-select-reactive>
        </ion-col>
        <ion-col size="6">
          <app-input-reactive
            title="Description"
            controlName="description"
            placeholder="Enter description"
            [form]="field('scaffold')"
          >
          </app-input-reactive>
        </ion-col>
        <ion-col size="3">
          <app-input-reactive
            title="Extra Hire %"
            type="number"
            controlName="extraHirePercentage"
            [form]="field('scaffold')"
            placeholder="%"
            (fieldChange)="update('scaffold')"
          >
          </app-input-reactive>
        </ion-col>
        <ion-col size="3">
          <app-input-reactive
            title="Extra Hire ({{ company.currency.symbol }})"
            type="number"
            controlName="extraHire"
            [form]="field('scaffold')"
            placeholder="Total Extra Hire"
          >
          </app-input-reactive>
        </ion-col>
        <ion-col>
          <app-input-reactive
            title="Length ({{ company.measurement.symbol }})"
            type="number"
            controlName="length"
            [form]="field('scaffold')"
            placeholder="L"
            (fieldChange)="update('scaffold')"
          >
          </app-input-reactive>
        </ion-col>
        <ion-col>
          <app-input-reactive
            title="Width ({{ company.measurement.symbol }})"
            type="number"
            controlName="width"
            [form]="field('scaffold')"
            placeholder="W"
            (fieldChange)="update('scaffold')"
          >
          </app-input-reactive>
        </ion-col>
        <ion-col>
          <app-input-reactive
            title="Height ({{ company.measurement.symbol }})"
            type="number"
            controlName="height"
            [form]="field('scaffold')"
            placeholder="H"
            (fieldChange)="update('scaffold')"
          >
          </app-input-reactive>
        </ion-col>
        <ion-col>
          <app-input-reactive
            title="Lifts"
            type="number"
            controlName="lifts"
            [form]="field('scaffold')"
            placeholder="No. Lifts"
            (fieldChange)="update('scaffold')"
          >
          </app-input-reactive>
        </ion-col>
        <ion-col>
          <app-input-reactive
            title="Boarded Lifts"
            type="number"
            controlName="boardedLifts"
            [form]="field('scaffold')"
            placeholder="No. Boarded Lifts"
          >
          </app-input-reactive>
        </ion-col>
        <ion-col>
          <app-input-reactive
            title="Level"
            type="number"
            [readonly]="true"
            controlName="level"
            [form]="field('scaffold')"
          >
          </app-input-reactive>
        </ion-col>
        <ion-col>
          <app-input-select-reactive
            title="Rate Profile"
            placeholder="Select Rate"
            controlName="rate"
            [form]="field('scaffold')"
            [selectedText]="field('scaffold.rate').value.name"
            (fieldChange)="update('scaffold')"
          >
            <ng-container *ngIf="rates$ | async as rates">
              <ion-select-option
                [value]="rate"
                *ngFor="let rate of rates.scaffoldRates"
                >{{ rate.name }}
              </ion-select-option>
            </ng-container>
          </app-input-select-reactive>
        </ion-col>
        <ion-col *ngIf="field('scaffold.rate').value">
          <app-input-text
            title="Rate override ({{
              field('scaffold.rate').value.name.startsWith('%')
                ? '%'
                : company.currency.symbol
            }})"
            type="number"
            [value]="field('scaffold.rate').value.rate"
            placeholder="Enter rate"
            (fieldChange)="updateRate('scaffold', $event)"
          >
          </app-input-text>
        </ion-col>
        <ion-col>
          <app-input-reactive
            title="Total ({{ company.currency.symbol }})"
            type="number"
            controlName="total"
            [form]="field('scaffold')"
            [readonly]="true"
            placeholder="Total"
          >
          </app-input-reactive>
        </ion-col>
      </ion-row>
      <ion-row formGroupName="scaffold">
        <ion-col size="12">
          <ion-text class="small" color="medium"
            >{{ company.terminology.hire }} Details</ion-text
          >
        </ion-col>
        <ion-col>
          <app-input-select-reactive
            title="{{ company.terminology.hire }} Period"
            placeholder="Select Hire Period"
            controlName="isWeeks"
            [form]="field('scaffold')"
            [selectedText]="field('scaffold.isWeeks').value ? 'Weeks' : 'Days'"
            (fieldChange)="update('scaffold')"
          >
            <ng-container>
              <ion-select-option [value]="true">Weeks </ion-select-option>
              <ion-select-option [value]="false">Days </ion-select-option>
            </ng-container>
          </app-input-select-reactive>
        </ion-col>
        <ion-col>
          <app-input-reactive
            [title]="
              field('scaffold.isWeeks').value
                ? 'Weeks Standing'
                : 'Days Standing'
            "
            type="number"
            controlName="daysStanding"
            [form]="field('scaffold')"
            [placeholder]="
              field('scaffold.isWeeks').value ? 'Enter Weeks' : 'Enter Days'
            "
            (fieldChange)="update('scaffold')"
          >
          </app-input-reactive>
        </ion-col>
        <ion-col>
          <app-input-select-reactive
            title="Rate Profile"
            placeholder="Select Rate"
            controlName="hireRate"
            [form]="field('scaffold')"
            [selectedText]="field('scaffold.hireRate').value.name"
            (fieldChange)="update('scaffold')"
          >
            <ng-container *ngIf="rates$ | async as rates">
              <ion-select-option
                [value]="rate"
                *ngFor="let rate of rates.hireRates"
                >{{ rate.name }}
              </ion-select-option>
            </ng-container>
          </app-input-select-reactive>
        </ion-col>
        <ion-col *ngIf="field('scaffold.hireRate').value">
          <app-input-text
            title="Rate override ({{
              field('scaffold.hireRate').value.name.startsWith('%')
                ? '%'
                : company.currency.symbol
            }})"
            type="number"
            [value]="field('scaffold.hireRate').value.rate"
            placeholder="Enter rate"
            (fieldChange)="updateRate('scaffoldHire', $event)"
          >
          </app-input-text>
        </ion-col>
        <ion-col>
          <app-input-reactive
            title="Total ({{ company.currency.symbol }})"
            type="number"
            controlName="hireTotal"
            [form]="field('scaffold')"
            [readonly]="true"
            placeholder="Hire Total"
          >
          </app-input-reactive>
        </ion-col>
      </ion-row>
      <ion-row
        formArrayName="attachments"
        class="mb-3"
        *ngFor="let attachment of attachmentsForms.controls; let i = index"
      >
        <ion-col size="12">
          <hr />
          <ion-note> Attachment {{ i + 1 }} </ion-note>
          <ion-chip
            outline
            color="danger"
            class="ion-float-end"
            (click)="deleteAttachment(i)"
          >
            <ion-label>Delete</ion-label>
          </ion-chip>
        </ion-col>
        <ion-col size="12">
          <app-input-select-reactive
            title="Scaffold Type"
            placeholder="Select Type"
            controlName="type"
            [form]="attachment"
            [selectedText]="arrField('attachments', i, 'type').value"
          >
            <ng-container *ngIf="types$ | async as types">
              <ion-select-option [value]="type" *ngFor="let type of types.types"
                >{{ type }}
              </ion-select-option>
            </ng-container>
          </app-input-select-reactive>
        </ion-col>
        <ion-col size="6">
          <app-input-reactive
            title="Description"
            controlName="description"
            placeholder="Enter description"
            [form]="attachment"
          >
          </app-input-reactive>
        </ion-col>
        <ion-col size="3">
          <app-input-reactive
            title="Extra Hire %"
            type="number"
            controlName="extraHirePercentage"
            placeholder="%"
            [form]="attachment"
            (fieldChange)="update('attachments', i)"
          >
          </app-input-reactive>
        </ion-col>
        <ion-col size="3">
          <app-input-reactive
            title="Extra Hire ({{ company.currency.symbol }})"
            type="number"
            controlName="extraHire"
            placeholder="Total Extra Hire"
            [form]="attachment"
          >
          </app-input-reactive>
        </ion-col>
        <ion-col>
          <app-input-reactive
            title="Length ({{ company.measurement.symbol }})"
            type="number"
            controlName="length"
            placeholder="L"
            [form]="attachment"
            (fieldChange)="update('attachments', i)"
          >
          </app-input-reactive>
        </ion-col>
        <ion-col>
          <app-input-reactive
            title="Width ({{ company.measurement.symbol }})"
            type="number"
            controlName="width"
            placeholder="W"
            [form]="attachment"
            (fieldChange)="update('attachments', i)"
          >
          </app-input-reactive>
        </ion-col>
        <ion-col>
          <app-input-reactive
            title="Height ({{ company.measurement.symbol }})"
            type="number"
            controlName="height"
            placeholder="H"
            [form]="attachment"
            (fieldChange)="update('attachments', i)"
          >
          </app-input-reactive>
        </ion-col>
        <ion-col>
          <app-input-reactive
            title="Lifts"
            type="number"
            controlName="lifts"
            placeholder="No. of Lifts"
            [form]="attachment"
            (fieldChange)="update('attachments', i)"
          >
          </app-input-reactive>
        </ion-col>
        <ion-col>
          <app-input-reactive
            title="Boarded Lifts"
            type="number"
            controlName="boardedLifts"
            [form]="attachment"
            placeholder="No. Boarded Lifts"
          >
          </app-input-reactive>
        </ion-col>
        <ion-col>
          <app-input-reactive
            title="Level"
            [optional]="true"
            type="number"
            controlName="level"
            placeholder="1"
            [form]="attachment"
          >
          </app-input-reactive>
        </ion-col>
        <ion-col>
          <app-input-select-reactive
            title="Rate Profile"
            placeholder="Select Rate"
            controlName="rate"
            [form]="attachment"
            (fieldChange)="update('attachments', i)"
            [selectedText]="arrField('attachments', i, 'rate').value.name"
          >
            <ng-container *ngIf="rates$ | async as rates">
              <ion-select-option
                [value]="rate"
                *ngFor="let rate of rates.scaffoldRates"
                >{{ rate.name }}
              </ion-select-option>
            </ng-container>
          </app-input-select-reactive>
        </ion-col>
        <ion-col *ngIf="arrField('attachments', i, 'rate').value">
          <app-input-text
            title="Rate override ({{
              arrField('attachments', i, 'rate').value.name.startsWith('%')
                ? '%'
                : company.currency.symbol
            }})"
            type="number"
            placeholder="Enter rate"
            [value]="arrField('attachments', i, 'rate').value.rate"
            (fieldChange)="updateRate('attachments', $event, i)"
          >
          </app-input-text>
        </ion-col>
        <ion-col>
          <app-input-reactive
            title="Total ({{ company.currency.symbol }})"
            type="number"
            controlName="total"
            [form]="attachment"
            placeholder="Total"
          >
          </app-input-reactive>
        </ion-col>
        <ion-col size="12" class="m-0 p-0">
          <ion-row class="m-0 p-0">
            <ion-col size="12">
              <ion-text class="small" color="medium"
                >{{ company.terminology.hire }} Details</ion-text
              >
            </ion-col>
            <ion-col>
              <app-input-select-reactive
                title="{{ company.terminology.hire }} Period"
                placeholder="Select Hire Period"
                controlName="isWeeks"
                [form]="attachment"
                [selectedText]="
                  arrField('attachments', i, 'isWeeks').value ? 'Weeks' : 'Days'
                "
                (fieldChange)="update('attachments', i)"
              >
                <ng-container>
                  <ion-select-option [value]="true">Weeks </ion-select-option>
                  <ion-select-option [value]="false">Days </ion-select-option>
                </ng-container>
              </app-input-select-reactive>
            </ion-col>
            <ion-col>
              <app-input-reactive
                [title]="
                  arrField('attachments', i, 'isWeeks').value
                    ? 'Weeks Standing'
                    : 'Days Standing'
                "
                type="number"
                controlName="daysStanding"
                [form]="attachment"
                [placeholder]="
                  arrField('attachments', i, 'isWeeks').value
                    ? 'Enter Weeks'
                    : 'Enter Days'
                "
                (fieldChange)="update('attachments', i)"
              >
              </app-input-reactive>
            </ion-col>
            <ion-col>
              <app-input-select-reactive
                title="Rate Profile"
                placeholder="Select Rate"
                controlName="hireRate"
                [form]="attachment"
                [selectedText]="
                  arrField('attachments', i, 'hireRate').value.name
                "
                (fieldChange)="update('attachments', i)"
              >
                <ng-container *ngIf="rates$ | async as rates">
                  <ion-select-option
                    [value]="rate"
                    *ngFor="let rate of rates.hireRates"
                    >{{ rate.name }}
                  </ion-select-option>
                </ng-container>
              </app-input-select-reactive>
            </ion-col>
            <ion-col *ngIf="arrField('attachments', i, 'hireRate').value">
              <app-input-text
                title="Rate override ({{
                  arrField('attachments', i, 'hireRate').value.name.startsWith(
                    '%'
                  )
                    ? '%'
                    : company.currency.symbol
                }})"
                type="number"
                [value]="arrField('attachments', i, 'hireRate').value.rate"
                placeholder="Enter rate"
                (fieldChange)="updateRate('attachmentHire', $event, i)"
              >
              </app-input-text>
            </ion-col>
            <ion-col>
              <app-input-reactive
                title="Total ({{ company.currency.symbol }})"
                type="number"
                controlName="hireTotal"
                [form]="attachment"
                [readonly]="true"
                placeholder="Hire Total"
              >
              </app-input-reactive>
            </ion-col>
          </ion-row>
        </ion-col>
      </ion-row>
      <ion-row class="mb-3">
        <ion-col>
          <ion-fab-button
            size="small"
            class="m-auto"
            color="success"
            (click)="addAttachment()"
          >
            <ion-icon name="add"></ion-icon>
          </ion-fab-button>
        </ion-col>
      </ion-row>
    </ion-col>
  </ion-row>
  <!-- BOARDS -->
  <app-title-block> {{ company.terminology.boards }} Details </app-title-block>
  <ion-row
    formArrayName="boards"
    class="card-outline mb-3"
    *ngFor="let board of boardForms.controls; let i = index"
  >
    <ion-col size="12">
      <ion-note> Item {{ i + 1 }} </ion-note>
      <ion-chip
        outline
        color="danger"
        class="ion-float-end"
        (click)="deleteBoard(i)"
      >
        <ion-label>Delete</ion-label>
      </ion-chip>
    </ion-col>
    <ion-col>
      <app-input-reactive
        title="Length ({{ company.measurement.symbol }})"
        type="number"
        controlName="length"
        placeholder="L"
        [form]="board"
        (fieldChange)="update('boards', i)"
      >
      </app-input-reactive>
    </ion-col>
    <ion-col>
      <app-input-reactive
        title="Width ({{ company.measurement.symbol }})"
        type="number"
        controlName="width"
        placeholder="W"
        [form]="board"
        (fieldChange)="update('boards', i)"
      >
      </app-input-reactive>
    </ion-col>
    <ion-col>
      <app-input-reactive
        title="Level ({{ company.measurement.symbol }})"
        type="number"
        controlName="height"
        placeholder="H"
        [form]="board"
        (fieldChange)="update('boards', i)"
      >
      </app-input-reactive>
    </ion-col>
    <ion-col>
      <app-input-reactive
        title="Qty"
        type="number"
        controlName="qty"
        placeholder="Enter Qty"
        [form]="board"
        (fieldChange)="update('boards', i)"
      >
      </app-input-reactive>
    </ion-col>
    <ion-col>
      <app-input-select-reactive
        title="Rate Profile"
        placeholder="Select Rate"
        controlName="rate"
        [form]="board"
        (fieldChange)="update('boards', i)"
        [selectedText]="arrField('boards', i, 'rate').value.name"
      >
        <ng-container *ngIf="rates$ | async as rates">
          <ion-select-option
            [value]="rate"
            *ngFor="let rate of rates.boardRates"
            >{{ rate.name }}
          </ion-select-option>
        </ng-container>
      </app-input-select-reactive>
    </ion-col>
    <ion-col *ngIf="arrField('boards', i, 'rate').value">
      <app-input-text
        title="Rate override ({{
          arrField('boards', i, 'rate').value.name.startsWith('%')
            ? '%'
            : company.currency.symbol
        }})"
        type="number"
        placeholder="Enter rate"
        [value]="arrField('boards', i, 'rate').value.rate"
        (fieldChange)="updateRate('boards', $event, i)"
      >
      </app-input-text>
    </ion-col>
    <ion-col>
      <app-input-reactive
        title="Extra Hire %"
        type="number"
        controlName="extraHirePercentage"
        placeholder="%"
        [form]="board"
        (fieldChange)="updateRate('boards', null, i)"
      >
      </app-input-reactive>
    </ion-col>
    <ion-col>
      <app-input-reactive
        title="Extra Hire ({{ company.currency.symbol }})"
        type="number"
        controlName="extraHire"
        placeholder="Total Extra Hire"
        [form]="board"
        [readonly]="true"
      >
      </app-input-reactive>
    </ion-col>
    <ion-col>
      <app-input-reactive
        title="Total ({{ company.currency.symbol }})"
        type="number"
        controlName="total"
        [form]="board"
        placeholder="Total"
        [readonly]="true"
      >
      </app-input-reactive>
    </ion-col>
  </ion-row>
  <ion-row class="mb-3">
    <ion-col>
      <ion-fab-button
        size="small"
        class="m-auto"
        color="success"
        (click)="addBoard()"
      >
        <ion-icon name="add"></ion-icon>
      </ion-fab-button>
    </ion-col>
  </ion-row>
  <!-- HIRE -->
  <ng-container *ngIf="isEdit && +field('hire').value.total > 0">
    <app-title-block> {{ company.terminology.hire }} Details </app-title-block>
    <ion-row class="card-outline mb-3">
      <ion-col size="12">
        <ion-row formGroupName="hire">
          <ion-col>
            <app-input-select-reactive
              title="Period"
              placeholder="Select Hire Period"
              controlName="isWeeks"
              [form]="field('hire')"
              [selectedText]="field('hire.isWeeks').value ? 'Weeks' : 'Days'"
              (fieldChange)="update('hire')"
            >
              <ng-container>
                <ion-select-option [value]="true">Weeks </ion-select-option>
                <ion-select-option [value]="false">Days </ion-select-option>
              </ng-container>
            </app-input-select-reactive>
          </ion-col>
          <ion-col>
            <app-input-reactive
              [title]="
                field('hire.isWeeks').value ? 'Weeks Standing' : 'Days Standing'
              "
              type="number"
              controlName="daysStanding"
              [form]="field('hire')"
              [placeholder]="
                field('hire.isWeeks').value ? 'Enter Weeks' : 'Enter Days'
              "
              (fieldChange)="update('hire')"
            >
            </app-input-reactive>
          </ion-col>
          <ion-col>
            <app-input-select-reactive
              title="Rate Profile"
              placeholder="Select Rate"
              controlName="rate"
              [form]="field('hire')"
              [selectedText]="field('hire.rate').value.name"
              (fieldChange)="update('hire')"
            >
              <ng-container *ngIf="rates$ | async as rates">
                <ion-select-option
                  [value]="rate"
                  *ngFor="let rate of rates.hireRates"
                  >{{ rate.name }}
                </ion-select-option>
              </ng-container>
            </app-input-select-reactive>
          </ion-col>
          <ion-col *ngIf="field('hire.rate').value">
            <app-input-text
              title="Rate override ({{
                field('hire.rate').value.name.startsWith('%')
                  ? '%'
                  : company.currency.symbol
              }})"
              type="number"
              [value]="field('hire.rate').value.rate"
              placeholder="Enter rate"
              (fieldChange)="updateRate('hire', $event)"
            >
            </app-input-text>
          </ion-col>
          <ion-col>
            <app-input-reactive
              title="Total ({{ company.currency.symbol }})"
              type="number"
              controlName="total"
              [form]="field('hire')"
              [readonly]="true"
              placeholder="Total"
            >
            </app-input-reactive>
          </ion-col>
        </ion-row>
      </ion-col>
    </ion-row>
  </ng-container>
  <!-- LABOUR -->
  <app-title-block> Labor Information </app-title-block>
  <ion-row class="mt-3" class="card-outline mb-3">
    <ion-col>
      <app-input-select-reactive
        title="Labor Profile"
        placeholder="Select Labor Profile"
        controlName="broker"
        [form]="form"
        [selectedText]="field('broker').value.name"
        (fieldChange)="changeBroker()"
      >
        <ng-container *ngIf="brokers$ | async as brokers">
          <ion-select-option [value]="broker" *ngFor="let broker of brokers"
            >{{ broker.name }}
          </ion-select-option>
        </ng-container>
      </app-input-select-reactive>
    </ion-col>
  </ion-row>

  <ng-container *ngIf="field('broker').value">
    <ion-row
      formArrayName="labour"
      class="card-outline mb-3"
      *ngFor="let labour of labourForms.controls; let i = index"
    >
      <ion-col size="12">
        <ion-note> Item {{ i + 1 }} </ion-note>
        <ion-chip
          outline
          color="danger"
          class="ion-float-end"
          (click)="deleteLabour(i)"
        >
          <ion-label>Delete</ion-label>
        </ion-chip>
      </ion-col>
      <ion-col>
        <app-input-select-reactive
          title="Type"
          placeholder="Select Labour Type"
          controlName="type"
          [form]="labour"
          [selectedText]="arrField('labour', i, 'type').value.name"
          (fieldChange)="update('labour', i)"
        >
          <ng-container>
            <ion-select-option
              [value]="broker"
              *ngFor="let broker of field('broker').value.types"
            >
              {{ broker.name }}
            </ion-select-option>
          </ng-container>
        </app-input-select-reactive>
      </ion-col>
      <ng-container *ngIf="arrField('labour', i, 'type').value">
        <ion-col>
          <app-input-reactive
            title="Hours per day"
            type="number"
            controlName="hours"
            [form]="labour"
            placeholder="Enter hours"
            (fieldChange)="update('labour', i)"
          >
          </app-input-reactive>
        </ion-col>
        <ion-col>
          <app-input-reactive
            title="Days needed"
            type="number"
            controlName="days"
            [form]="labour"
            placeholder="Enter days"
            (fieldChange)="update('labour', i)"
          >
          </app-input-reactive>
        </ion-col>
        <ion-col>
          <app-input-reactive
            title="Qty"
            type="number"
            controlName="qty"
            [form]="labour"
            placeholder="Qty"
            (fieldChange)="update('labour', i)"
          >
          </app-input-reactive>
        </ion-col>
        <ion-col>
          <app-input-select-reactive
            title="Rate Profile"
            placeholder="Select Rate"
            controlName="rate"
            [form]="labour"
            (fieldChange)="update('labour', i)"
            [selectedText]="arrField('labour', i, 'rate').value.name"
          >
            <ng-container>
              <ion-select-option
                [value]="{
                  name: 'NT',
                  rate: arrField('labour', i, 'type').value.nt
                }"
              >
                Normal time
              </ion-select-option>
              <ion-select-option
                [value]="{
                  name: 'OT1',
                  rate: arrField('labour', i, 'type').value.ot1
                }"
              >
                Over time 1
              </ion-select-option>
              <ion-select-option
                [value]="{
                  name: 'OT2',
                  rate: arrField('labour', i, 'type').value.ot2
                }"
              >
                Over time 2
              </ion-select-option>
              <ion-select-option
                [value]="{
                  name: 'PH',
                  rate: arrField('labour', i, 'type').value.ph
                }"
              >
                Public holiday
              </ion-select-option>
            </ng-container>
          </app-input-select-reactive>
        </ion-col>
        <ion-col *ngIf="arrField('labour', i, 'rate').value">
          <app-input-text
            title="Rate override ({{
              arrField('labour', i, 'rate').value.name.startsWith('%')
                ? '%'
                : company.currency.symbol
            }})"
            type="number"
            [value]="arrField('labour', i, 'rate').value.rate"
            placeholder="Enter rate"
            (fieldChange)="updateRate('labour', $event, i)"
          >
          </app-input-text>
        </ion-col>
        <ion-col>
          <app-input-reactive
            title="Total ({{ company.currency.symbol }})"
            type="number"
            controlName="total"
            [form]="labour"
            placeholder="Total"
            [readonly]="true"
          >
          </app-input-reactive>
        </ion-col>
      </ng-container>
    </ion-row>

    <ion-row>
      <ion-col>
        <ion-fab-button
          size="small"
          class="m-auto"
          color="success"
          (click)="addLabour()"
        >
          <ion-icon name="add"></ion-icon>
        </ion-fab-button>
      </ion-col>
    </ion-row>
  </ng-container>

  <!-- TRANSPORT -->
  <app-title-block> Transport Information </app-title-block>
  <ion-row class="mt-3" class="card-outline mb-3">
    <ion-col>
      <app-input-select-reactive
        title="Transport Profile"
        placeholder="Select Transport Profile"
        controlName="transportProfile"
        [form]="form"
        [selectedText]="field('transportProfile').value.name"
        (fieldChange)="changeTransport()"
      >
        <ng-container *ngIf="transport$ | async as profiles">
          <ion-select-option [value]="profile" *ngFor="let profile of profiles"
            >{{ profile.name }}
          </ion-select-option>
        </ng-container>
      </app-input-select-reactive>
    </ion-col>
  </ion-row>
  <ng-container *ngIf="field('transportProfile').value">
    <ion-row
      formArrayName="transport"
      class="card-outline mb-3"
      *ngFor="let transport of transportForms.controls; let i = index"
    >
      <ion-col size="12">
        <ion-note> Item {{ i + 1 }} </ion-note>
        <ion-chip
          outline
          color="danger"
          class="ion-float-end"
          (click)="deleteTransport(i)"
        >
          <ion-label>Delete</ion-label>
        </ion-chip>
      </ion-col>
      <ion-col>
        <app-input-select-reactive
          title="Type"
          placeholder="Select Vehicle Type"
          controlName="type"
          [form]="transport"
          [selectedText]="arrField('transport', i, 'type').value.name"
          (fieldChange)="update('transport', i)"
        >
          <ng-container>
            <ion-select-option
              [value]="vehicle"
              *ngFor="let vehicle of field('transportProfile').value.types"
            >
              {{ vehicle.name }}
            </ion-select-option>
          </ng-container>
        </app-input-select-reactive>
      </ion-col>
      <ng-container *ngIf="arrField('transport', i, 'type').value">
        <ion-col>
          <app-input-text
            title="Max Load ({{ company.mass.symbol }})"
            type="number"
            [value]="arrField('transport', i, 'type').value.maxLoad"
            [readonly]="true"
          >
          </app-input-text>
        </ion-col>
        <ion-col>
          <app-input-reactive
            title="Hours per day"
            type="number"
            controlName="hours"
            [form]="transport"
            placeholder="Enter hours"
            (fieldChange)="update('transport', i)"
          >
          </app-input-reactive>
        </ion-col>
        <ion-col>
          <app-input-reactive
            title="Days needed"
            type="number"
            controlName="days"
            [form]="transport"
            placeholder="Enter days"
            (fieldChange)="update('transport', i)"
          >
          </app-input-reactive>
        </ion-col>
        <ion-col>
          <app-input-reactive
            title="Qty"
            type="number"
            controlName="qty"
            [form]="transport"
            placeholder="Qty"
            (fieldChange)="update('transport', i)"
          >
          </app-input-reactive>
        </ion-col>
        <ion-col>
          <app-input-text
            title="Rate override ({{ company.currency.symbol }})"
            type="number"
            [value]="arrField('transport', i, 'type').value.rate"
            placeholder="Enter rate"
            (fieldChange)="updateRate('transport', $event, i)"
          >
          </app-input-text>
        </ion-col>
        <ion-col>
          <app-input-reactive
            title="Extra Hire %"
            type="number"
            controlName="extraHirePercentage"
            placeholder="%"
            [form]="transport"
            (fieldChange)="updateRate('transport', null, i)"
          >
          </app-input-reactive>
        </ion-col>
        <ion-col>
          <app-input-reactive
            title="Extra Hire ({{ company.currency.symbol }})"
            type="number"
            controlName="extraHire"
            placeholder="Total Extra Hire"
            [form]="transport"
            [readonly]="true"
          >
          </app-input-reactive>
        </ion-col>
        <ion-col>
          <app-input-reactive
            title="Total ({{ company.currency.symbol }})"
            type="number"
            controlName="total"
            [form]="transport"
            placeholder="Total"
            [readonly]="true"
          >
          </app-input-reactive>
        </ion-col>
      </ng-container>
    </ion-row>

    <ion-row>
      <ion-col>
        <ion-fab-button
          size="small"
          class="m-auto"
          color="success"
          (click)="addTransport()"
        >
          <ion-icon name="add"></ion-icon>
        </ion-fab-button>
      </ion-col>
    </ion-row>
  </ng-container>

  <!-- ADDITIONALS -->
  <app-title-block> Additionals Information </app-title-block>
  <ion-row
    formArrayName="additionals"
    class="card-outline mb-3"
    *ngFor="let additional of additionalForms.controls; let i = index"
  >
    <ion-col size="12">
      <ion-note> Item {{ i + 1 }} </ion-note>
      <ion-chip
        outline
        color="danger"
        class="ion-float-end"
        (click)="deleteAdditional(i)"
      >
        <ion-label>Delete</ion-label>
      </ion-chip>
    </ion-col>
    <ion-col>
      <app-input-reactive
        title="Name"
        controlName="name"
        [form]="additional"
        placeholder="Item Name"
      >
      </app-input-reactive>
    </ion-col>
    <ion-col>
      <app-input-reactive
        title="Qty"
        type="number"
        controlName="qty"
        [form]="additional"
        placeholder="Qty"
        (fieldChange)="update('additionals', i)"
      >
      </app-input-reactive>
    </ion-col>
    <ion-col>
      <app-input-reactive
        title="Days on Hire"
        type="number"
        controlName="daysStanding"
        [form]="additional"
        placeholder="Days on hire"
        (fieldChange)="update('additionals', i)"
      >
      </app-input-reactive>
    </ion-col>
    <ion-col>
      <app-input-select-reactive
        title="Rate Profile"
        placeholder="Select Rate"
        controlName="rate"
        [form]="additional"
        (fieldChange)="update('additionals', i)"
        [selectedText]="arrField('additionals', i, 'rate').value.name"
      >
        <ng-container *ngIf="rates$ | async as rates">
          <ion-select-option
            [value]="rate"
            *ngFor="let rate of rates.additionalRates"
            >{{ rate.name }}
          </ion-select-option>
        </ng-container>
      </app-input-select-reactive>
    </ion-col>
    <ion-col *ngIf="arrField('additionals', i, 'rate').value">
      <app-input-text
        title="Rate override ({{
          arrField('additionals', i, 'rate').value.name
            ? arrField('additionals', i, 'rate').value.name.startsWith('%')
              ? '%'
              : company.currency.symbol
            : ''
        }})"
        type="number"
        [value]="arrField('additionals', i, 'rate').value.rate"
        placeholder="Enter rate"
        (fieldChange)="updateRate('additionals', $event, i)"
      >
      </app-input-text>
    </ion-col>
    <ion-col>
      <app-input-reactive
        title="Extra Hire %"
        type="number"
        controlName="extraHirePercentage"
        placeholder="%"
        [form]="additional"
        (fieldChange)="updateRate('additionals', null, i)"
      >
      </app-input-reactive>
    </ion-col>
    <ion-col>
      <app-input-reactive
        title="Extra Hire ({{ company.currency.symbol }})"
        type="number"
        controlName="extraHire"
        placeholder="Total Extra Hire"
        [form]="additional"
        [readonly]="true"
      >
      </app-input-reactive>
    </ion-col>
    <ion-col>
      <app-input-reactive
        title="Total ({{ company.currency.symbol }})"
        type="number"
        controlName="total"
        [form]="additional"
        placeholder="Total"
        [readonly]="true"
      >
      </app-input-reactive>
    </ion-col>
  </ion-row>
  <ion-row>
    <ion-col>
      <ion-fab-button
        size="small"
        class="m-auto"
        color="success"
        (click)="addAdditional()"
      >
        <ion-icon name="add"></ion-icon>
      </ion-fab-button>
    </ion-col>
  </ion-row>

  <!-- BUDGET -->

  <app-budget-breakdown
    [estimate]="estimate"
    *ngIf="!updating"
  ></app-budget-breakdown>
</form>
